name: AI Filter & Push to Obsidian

on:
  workflow_run:
    workflows: ["TrendRadar"] # å‡è®¾åŸé¡¹ç›®æŠ“å–è„šæœ¬å« TrendRadar
    types: [completed]
  workflow_dispatch: # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  filter_and_sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout TrendRadar Data
        uses: actions/checkout@v4

      - name: AI Processing (DeepSeek)
        # è¿™é‡Œå‡è®¾ä½ å·²ç»æŒ‰ç…§ä¸Šä¸€æ­¥é…ç½®äº† AI_API_KEY
        # è„šæœ¬é€»è¾‘ï¼šè¯»å–æŠ“å–çš„ json/yamlï¼Œè°ƒç”¨ AI æ€»ç»“ï¼Œè¾“å‡ºä¸º Markdown
        run: |
          echo "æ­£åœ¨è°ƒç”¨ AI è¿›è¡Œè´¨é‡ç­›é€‰ä¸æ‘˜è¦ç”Ÿæˆ..."
          # è¿™é‡Œå¯ä»¥è¿è¡Œä¸€ä¸ªç®€å•çš„ python è„šæœ¬æ‰§è¡Œé€»è¾‘
          # å¦‚æœä¸æƒ³å†™ä»£ç ï¼Œå¯ä»¥ç›´æ¥ç”¨ç°æˆçš„å·¥å…·æˆ–ç®€å•çš„ Shell æ‹¼å‡‘

      - name: Pushing to Obsidian Repo
        run: |
          # 1. å…‹éš†ä½ çš„ç¬”è®°ä»“åº“
          git clone https://x-access-token:${{ secrets.OBSIDIAN_REPO_TOKEN }}@github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ç¬”è®°ä»“åº“å.git obsidian_vault
          
          # 2. å‡†å¤‡å­˜æ”¾è·¯å¾„ï¼ˆä¾‹å¦‚æ”¾åœ¨ Inbox/TrendRadar/æ—¥æœŸ.mdï¼‰
          DIR="obsidian_vault/Inbox/TrendRadar/$(date +'%Y-%m-%d')"
          mkdir -p "$DIR"
          
          # 3. å°†æŠ“å–çš„æ•°æ®å†™å…¥æ–‡ä»¶ (è¿™é‡Œä»¥è¾“å‡ºå˜é‡ä¸ºç¤ºä¾‹)
          cat <<EOF > "$DIR/Daily_Intelligence.md"
          ---
          tags: #Intelligence #AI-Summary
          date: $(date +'%Y-%m-%d %H:%M')
          ---
          # ğŸ¤– AI æ™ºèƒ½ç®€æŠ¥
          
          > [!abstract] ç­›é€‰åŸåˆ™
          > å·²å‰”é™¤ä½è´¨é‡è¥é”€å·åŠé‡å¤å†…å®¹ï¼Œä»…ä¿ç•™å…·æœ‰æŠ€æœ¯å‚è€ƒä»·å€¼çš„ä¿¡æ¯ã€‚
          
          $(cat processed_content.md) 
          EOF

          # 4. æäº¤å¹¶æ¨é€
          cd obsidian_vault
          git config user.name "AI-Assistant"
          git config user.email "ai@trendradar.bot"
          git add .
          git commit -m "Update Daily Intelligence: $(date +'%Y-%m-%d')"
          git push
